<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🛒 مشترياتي</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff; text-align:center;}
header { background:#6c757d; color:#fff; padding:12px; font-size:22px;}
nav { background:#f8f9fa; display:flex; justify-content:space-around; padding:8px 0; border-top:1px solid #ddd; border-bottom:1px solid #ddd; }
nav a { text-decoration:none; color:#333; font-size:14px;}
nav a:hover { color:#007bff; }
section { margin:10px auto; width:95%; max-width:700px;}
.item { border:1px solid #ddd; border-radius:6px; margin:5px 0; padding:8px; text-align:right; }
.item img { width:80px; height:80px; object-fit:cover; border-radius:4px; float:right; margin-left:8px;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd; margin-top:10px; clear:both;}
.clearfix::after {content:""; clear:both; display:table;}
</style>
</head>
<body>

<header>🛒 مشترياتي</header>

<nav>
  <a href="index.html">🏠 المتجر</a>
  <a href="mypurchases.html">🛒 مشترياتي</a>
  <a href="register.html">🔑 حسابي</a>
</nav>

<section id="purchasesContainer"></section>

<footer>💎 Powered by Almasa 💎</footer>

<script>
// التحقق من تسجيل الدخول
let logged=JSON.parse(localStorage.getItem('loggedUser'));
if(!logged || logged.role!=="user") {
  alert("⚠️ يجب تسجيل الدخول أولاً.");
  location.href="register.html";
}

// جلب المشتريات
let purchases=JSON.parse(localStorage.getItem('purchases')||"[]");
let userPurchases=purchases.filter(p=>p.phone===logged.phone);

// تجميع نفس السلعة معًا
let grouped={};
userPurchases.forEach(p=>{
  let key=p.name;
  if(grouped[key]){
    grouped[key].count+=1;
  }else{
    grouped[key]={...p,count:1};
  }
});

// توليد HTML
let html="";
for(let key in grouped){
  let p=grouped[key];
  html+=`
  <div class="item clearfix">
    <img src="${p.image}" alt="${p.name}">
    <div><b>${p.name}</b> - السعر: ${p.price} جنيه</div>
    <div>✅ تم شراء: ${p.count} مرة</div>
  </div>`;
}

document.getElementById('purchasesContainer').innerHTML=html || "📦 لم يتم شراء منتجات بعد.";
</script>

</body>
</html>
