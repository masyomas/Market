<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</title>
<style>
body { font-family:'Tahoma',sans-serif; background:#f9f9f9; margin:0; padding:0; text-align:center; direction:rtl;}
header { background:#ffc107; color:#000; padding:15px; font-size:22px;}
nav { background:#ffc107; color:#000; padding:8px; text-align:right;}
nav a { color:#000; text-decoration:none; margin:0 5px; font-size:15px;}
nav a:hover { text-decoration:underline;}
main { margin:20px;}
section { background:#fff; margin:10px auto; padding:10px; border-radius:8px; width:300px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
img { width:100%; border-radius:8px; }
button { margin:3px; padding:4px 8px; font-size:13px; border:none; border-radius:4px; cursor:pointer;}
.cancelBtn { background:#dc3545; color:#fff;}
.cancelBtn:hover { background:#a71d2a;}
.logoutBtn { background:#007bff; color:#fff; margin:10px;}
.logoutBtn:hover { background:#0056b3;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</header>

<nav>
  <a href="index.html">ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</a> |
  <a href="register.html">ğŸ“ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</a> |
  <a href="myPurchases.html">ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</a> |
  <a href="admin.html">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
</nav>

<main>
  <div id="userInfo"></div>
  <div id="bonusInfo"></div>
  <button class="logoutBtn" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

  <h4>ğŸ›’ Ø§Ù„Ø³Ù„Ø¹ Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ø´Ø±Ø§Ø¦Ù‡Ø§</h4>
  <div id="purchasesList"></div>
</main>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
let users = JSON.parse(localStorage.getItem('users') || "[]");
let myUser = users[users.length-1]; // Ù†ÙØªØ±Ø¶ Ø¢Ø®Ø± Ù…Ø³Ø¬Ù„ Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ

function showUserInfo(){
  if(myUser){
    document.getElementById('userInfo').innerHTML = 
      `<strong>ğŸ‘¤ ${myUser.name}</strong> | ğŸ”‘ Ø§Ù„ÙƒÙˆØ¯: ${myUser.code}`;
  }
}

function showBonus(){
  let bonusPercent = parseFloat(localStorage.getItem('bonusPercent')) || 0;
  let myPurchases = JSON.parse(localStorage.getItem('myPurchases') || "[]");
  let total = myPurchases.reduce((sum, p)=> sum + parseFloat(p.price), 0);
  let bonus = total * bonusPercent / 100;
  document.getElementById('bonusInfo').innerHTML = 
    `ğŸ’° Ø§Ù„Ø¨ÙˆÙ†Øµ Ø§Ù„Ù…Ø³ØªØ­Ù‚ (${bonusPercent}%): <strong>${bonus.toFixed(2)} Ø¬Ù†ÙŠÙ‡</strong>`;
}

function showPurchases(){
  let myPurchases = JSON.parse(localStorage.getItem('myPurchases') || "[]");
  let now = Date.now();
  let html = "";
  myPurchases.forEach((item, index)=>{
    let canCancel = (now - item.time) <= 6*60*60*1000; // 6 Ø³Ø§Ø¹Ø§Øª
    let date = new Date(item.time).toLocaleString('ar-EG');
    html += `<section>
      <img src="${item.img}" alt="${item.name}">
      <div>ğŸ·ï¸ <strong>${item.name}</strong></div>
      <div>ğŸ’° ${item.price} Ø¬Ù†ÙŠÙ‡</div>
      <div>ğŸ“‹ ${item.details || ""}</div>
      <div>ğŸ•’ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡: ${date}</div>
      ${canCancel ? `<button class="cancelBtn" onclick="cancelPurchase(${index})">ğŸ—‘ï¸ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡</button>`:""}
    </section>`;
  });
  document.getElementById('purchasesList').innerHTML = html || "<p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø´Ø±Ø§Ø¡ Ø£ÙŠ Ø³Ù„Ø¹Ø© Ø¨Ø¹Ø¯</p>";
}

function cancelPurchase(index){
  if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡ØŸ")){
    let myPurchases = JSON.parse(localStorage.getItem('myPurchases') || "[]");
    myPurchases.splice(index,1);
    localStorage.setItem('myPurchases', JSON.stringify(myPurchases));
    showPurchases();
    showBonus();
  }
}

function logout(){
  alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  location.href = "register.html";
}

// ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
showUserInfo();
showBonus();
showPurchases();
</script>

</body>
</html>