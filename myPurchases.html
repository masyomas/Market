<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff; text-align:center;}
header { background:#6c757d; color:#fff; padding:12px; font-size:22px;}
nav { background:#f8f9fa; display:flex; justify-content:space-around; padding:8px 0; border-top:1px solid #ddd; border-bottom:1px solid #ddd; }
nav a { text-decoration:none; color:#333; font-size:14px;}
nav a:hover { color:#007bff; }
section { margin:10px auto; width:95%; max-width:700px;}
.item { border:1px solid #ddd; border-radius:6px; margin:5px 0; padding:8px; text-align:right; }
.item img { width:80px; height:80px; object-fit:cover; border-radius:4px; float:right; margin-left:8px;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd; margin-top:10px; clear:both;}
.clearfix::after {content:""; clear:both; display:table;}
</style>
</head>
<body>

<header>ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</header>

<nav>
  <a href="index.html">ğŸ  Ø§Ù„Ù…ØªØ¬Ø±</a>
  <a href="mypurchases.html">ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</a>
  <a href="register.html">ğŸ”‘ Ø­Ø³Ø§Ø¨ÙŠ</a>
</nav>

<section id="purchasesContainer"></section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
let logged=JSON.parse(localStorage.getItem('loggedUser'));
if(!logged || logged.role!=="user") {
  alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
  location.href="register.html";
}

// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
let purchases=JSON.parse(localStorage.getItem('purchases')||"[]");
let userPurchases=purchases.filter(p=>p.phone===logged.phone);

// ØªØ¬Ù…ÙŠØ¹ Ù†ÙØ³ Ø§Ù„Ø³Ù„Ø¹Ø© Ù…Ø¹Ù‹Ø§
let grouped={};
userPurchases.forEach(p=>{
  let key=p.name;
  if(grouped[key]){
    grouped[key].count+=1;
  }else{
    grouped[key]={...p,count:1};
  }
});

// ØªÙˆÙ„ÙŠØ¯ HTML
let html="";
for(let key in grouped){
  let p=grouped[key];
  html+=`
  <div class="item clearfix">
    <img src="${p.image}" alt="${p.name}">
    <div><b>${p.name}</b> - Ø§Ù„Ø³Ø¹Ø±: ${p.price} Ø¬Ù†ÙŠÙ‡</div>
    <div>âœ… ØªÙ… Ø´Ø±Ø§Ø¡: ${p.count} Ù…Ø±Ø©</div>
  </div>`;
}

document.getElementById('purchasesContainer').innerHTML=html || "ğŸ“¦ Ù„Ù… ÙŠØªÙ… Ø´Ø±Ø§Ø¡ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯.";
</script>

</body>
</html>
