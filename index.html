<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</title>
<style>
body { font-family:'Tahoma',sans-serif; background:#fff; margin:0; padding:0; text-align:center; direction:rtl;}
header { background:#6c757d; color:#fff; padding:15px; font-size:22px;}
nav { background:#6c757d; color:#fff; padding:8px; text-align:right;}
nav a { color:#fff; text-decoration:none; margin:0 5px; font-size:15px;}
nav a:hover { text-decoration:underline;}
main { margin:20px;}
.products { display:flex; flex-wrap:wrap; justify-content:center;}
.product { border:1px solid #ddd; border-radius:8px; padding:10px; margin:8px; width:160px;}
.product img { width:140px; height:140px; object-fit:cover; border-radius:4px;}
button { margin-top:5px; padding:4px 10px; font-size:13px; background:#6c757d; color:#fff; border:none; border-radius:4px; cursor:pointer;}
button:hover { background:#555;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>ğŸ¬ Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</header>

<nav>
  <a href="index.html">ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</a> |
  <a href="register.html">ğŸ“ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</a> |
  <a href="myPurchases.html">ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</a> |
  <a href="#" onclick="logoutUser()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
</nav>

<main>
  <h3>ğŸ“¦ Ø§Ù„Ø³Ù„Ø¹ Ø§Ù„Ù…ØªØ§Ø­Ø©:</h3>
  <div class="products" id="productList">
    <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
  </div>
</main>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
let loggedUser = JSON.parse(localStorage.getItem('loggedUser'));
if(!loggedUser){
  alert("âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  location.href = "register.html";
}

// ğŸ“¦ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† localStorage ÙˆØ¹Ø±Ø¶Ù‡Ø§
let products = JSON.parse(localStorage.getItem('products') || "[]");

// ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© (Ù„Ù‡Ø§ Ø§Ø³Ù…ØŒ Ø³Ø¹Ø±ØŒ ØµÙˆØ±Ø©)
products = products.filter(p => p.name && p.price && p.img);

let html = "";
products.forEach((p,index)=>{
  html += `
    <div class="product">
      <img src="${p.img}">
      <br/><b>${p.name}</b>
      <br/>Ø§Ù„Ø³Ø¹Ø±: ${p.price} Ø¬Ù†ÙŠÙ‡
      <br/>${p.details || ''}
      <br/>
      <button onclick="likeProduct(${index})">â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨</button>
      <button onclick="buyProduct(${index})">ğŸ›’ Ø´Ø±Ø§Ø¡</button>
    </div>
  `;
});
document.getElementById('productList').innerHTML = html;

// â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø¬Ø±Ø¯ Ø¥Ø´Ø¹Ø§Ø±)
function likeProduct(i){
  alert("â¤ï¸ Ø£Ø¹Ø¬Ø¨Ùƒ Ø§Ù„Ù…Ù†ØªØ¬: " + products[i].name);
}

// ğŸ›’ Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬
function buyProduct(i){
  let p = products[i];
  let purchases = JSON.parse(localStorage.getItem('purchases') || "[]");
  purchases.push({
    userCode: loggedUser.code,
    name: p.name,
    price: p.price,
    img: p.img,
    details: p.details,
    time: new Date()
  });
  localStorage.setItem('purchases', JSON.stringify(purchases));

  // Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… EmailJS (Ù„Ùˆ Ù…ÙØ¹Ø¯)
  if(localStorage.getItem('adminEmail')){
    emailjs.send("service_48zkysa", "template_ntfbz2v", {
      to_email: localStorage.getItem('adminEmail'),
      user_name: loggedUser.name,
      user_code: loggedUser.code,
      product_name: p.name,
      product_price: p.price,
      date: new Date().toLocaleString()
    }).then(()=>{
      alert("âœ… ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯");
    },()=>{
      alert("âš ï¸ ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯");
    });
  } else {
    alert("âœ… ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡");
  }
}

// ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logoutUser(){
  localStorage.removeItem('loggedUser');
  alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  location.href = "register.html";
}

// ğŸ§© Ø§Ù„ØªÙ‚Ø§Ø· ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰
window.addEventListener('storage', function(e){
  if(e.key === 'loggedUser' && e.newValue === null){
    alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰");
    location.href = "register.html";
  }
});
</script>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
  emailjs.init("5eKkOQU28_S0Fon2x"); // Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø¹Ø§Ù…
</script>

</body>
</html>
