<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; text-align:center; background:#fff;}
header { background:#6c757d; color:#fff; padding:15px; font-size:22px;}
nav { background:#6c757d; color:#fff; padding:8px;}
nav a { color:#fff; text-decoration:none; margin:0 5px; font-size:14px;}
nav a:hover { text-decoration:underline;}
main { display:flex; flex-wrap:wrap; justify-content:center; margin:10px;}
.product { border:1px solid #ddd; border-radius:8px; padding:8px; margin:5px; width:45%; box-sizing:border-box;}
.product img { width:100%; max-height:120px; object-fit:cover; border-radius:6px;}
.product h4 { margin:5px 0; font-size:15px;}
.product p { margin:2px 0; font-size:13px; color:#555;}
button { margin-top:5px; padding:4px 10px; font-size:12px; background:#6c757d; color:#fff; border:none; border-radius:4px; cursor:pointer;}
button:hover { background:#555;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</header>

<nav>
  <a href="index.html">ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</a> |
  <a href="register.html">ğŸ“ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</a> |
  <a href="myPurchases.html">ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</a> |
  <a href="#" onclick="logoutUser()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
</nav>

<main id="productList">
<!-- Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø³Ù„Ø¹ Ù‡Ù†Ø§ -->
</main>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø¹ Ù…Ù† localStorage
let products = JSON.parse(localStorage.getItem('products')||"[]");
let container = document.getElementById('productList');

if(products.length===0){
  container.innerHTML="<p>âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù„Ø¹ Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§</p>";
}else{
  let html="";
  products.forEach((p,idx)=>{
    let img = p.img && p.img.trim()!=="" ? p.img : "picture/empty.jpg";
    html+=`
    <div class="product">
      <img src="${img}" alt="${p.name}">
      <h4>${p.name}</h4>
      <p>Ø§Ù„Ø³Ø¹Ø±: ${p.price} Ø¬Ù†ÙŠÙ‡</p>
      <p>${p.details||""}</p>
      <button onclick="buyProduct(${idx})">ğŸ›’ Ø´Ø±Ø§Ø¡</button>
    </div>`;
  });
  container.innerHTML=html;
}

// Ø´Ø±Ø§Ø¡ Ø³Ù„Ø¹Ø©
function buyProduct(idx){
  let loggedUser=JSON.parse(localStorage.getItem('loggedUser'));
  if(!loggedUser){
    alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    location.href="register.html";
    return;
  }
  let p=products[idx];
  let purchases=JSON.parse(localStorage.getItem('purchases')||"[]");
  purchases.push({ userCode:loggedUser.code, name:p.name, price:p.price, date:new Date().toLocaleString() });
  localStorage.setItem('purchases',JSON.stringify(purchases));

  let email=localStorage.getItem('adminEmail')||"mahmoudadelsaleh@gmail.com";
  alert(`âœ… ØªÙ… Ø´Ø±Ø§Ø¡ ${p.name}\nØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ ${email}`);
}

// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
function logoutUser(){
  localStorage.removeItem('loggedUser');
  alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  location.href="register.html";
}

// Ø§Ù„ØªÙ‚Ø§Ø· ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰
window.addEventListener('storage',function(e){
  if(e.key==='loggedUser' && e.newValue===null){
    alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰");
    location.href='register.html';
  }
});
</script>

</body>
</html>
