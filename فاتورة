<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>๐ ูุทุงุจูุฉ ุงููุงุชูุฑุฉ</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:20px; background:#f9f9f9; }
h3 { color:#007bff; }
select, textarea, button { width:100%; margin:10px 0; padding:6px; border-radius:4px; border:1px solid #ccc; }
button { background:#28a745; color:#fff; cursor:pointer; }
button:hover { background:#218838; }
</style>
</head>
<body>

<h3>๐ ูุทุงุจูุฉ ุงููุงุชูุฑุฉ</h3>

<label for="clientSelect">ุงุฎุชุฑ ููุฏ ุงูุนููู:</label>
<select id="clientSelect" onchange="showProducts()">
  <option value="">-- ุงุฎุชุฑ ููุฏ ุงูุนููู --</option>
</select>

<label for="productsBox">ุฌููุน ุงูุณูุน ุงูุชู ุงุดุชุฑุงูุง ุงูุนููู:</label>
<textarea id="productsBox" rows="6" readonly></textarea>

<button onclick="matchInvoice()">๐งพ ูุทุงุจูุฉ ุงููุงุชูุฑุฉ</button>

<script>
// ุฌูุจ ุงููุณุชุฎุฏููู ูุงููุดุชุฑูุงุช ูู localStorage
let users = JSON.parse(localStorage.getItem('users') || "[]");
let purchases = JSON.parse(localStorage.getItem('purchases') || "[]");

// ุชุนุจุฆุฉ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุจุฃููุงุฏ ุงูุนููุงุก
let select = document.getElementById('clientSelect');
users.forEach(u=>{
  if(u.role=="user"){
    let opt = document.createElement('option');
    opt.value = u.code;
    opt.text = `${u.name} - ููุฏ: ${u.code}`;
    select.appendChild(opt);
  }
});

// ุนูุฏ ุงุฎุชูุงุฑ ููุฏ ุนููู ูุนุฑุถ ุณูุน ูุดุชุฑูุงุชู
function showProducts(){
  let code = document.getElementById('clientSelect').value;
  if(!code) { document.getElementById('productsBox').value=""; return; }

  let userPurchases = purchases.filter(p=>p.code==code);
  let productsList = userPurchases.map(p=>p.product).join('\n');
  document.getElementById('productsBox').value = productsList || "ูุง ุชูุฌุฏ ูุดุชุฑูุงุช.";
}

// ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ูุทุงุจูุฉ ุงููุงุชูุฑุฉ
function matchInvoice(){
  alert("๐ ุชู ุงูุถุบุท ุนูู ุฒุฑ ูุทุงุจูุฉ ุงููุงุชูุฑุฉ!\nููููู ููุง ุจุฑูุฌุฉ ูุง ุชุฑูุฏ ุชูููุฐู.");
}
</script>

</body>
</html>
