<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>💎 لوحة الإدارة الشاملة</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff;}
header { background:#6c757d; color:#fff; padding:12px; font-size:18px; text-align:center;}
nav { display:flex; justify-content:space-around; background:#007bff; }
nav button { flex:1; padding:8px; background:#007bff; color:#fff; border:none; font-size:14px; cursor:pointer; }
nav button.active { background:#0056b3; }
section { display:none; padding:10px; }
section.active { display:block; }
table { width:100%; border-collapse:collapse; margin-top:8px;}
th, td { border:1px solid #ccc; padding:4px; font-size:13px;}
input, select { width:95%; padding:6px; margin:4px 0; border:1px solid #ccc; border-radius:4px;}
button.action { background:#28a745; color:#fff; padding:6px 10px; border:none; border-radius:4px; cursor:pointer; margin:4px 0;}
button.action:hover { background:#218838;}
.delBtn { background:#dc3545; }
.delBtn:hover { background:#c82333;}
footer { background:#f1f1f1; text-align:center; padding:6px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>💎 لوحة الإدارة الشاملة</header>

<nav>
  <button onclick="showTab('dashboard')" class="active">📊 لوحة التحكم</button>
  <button onclick="showTab('products')">📦 السلع والمخزون</button>
  <button onclick="showTab('sales')">💰 مبيعاتي</button>
  <button onclick="showTab('users')">👥 المستخدمين والمديرين</button>
  <button onclick="showTab('invoice')">🧾 فاتورة</button>
</nav>

<section id="dashboard" class="active">⏳ جاري التحميل...</section>
<section id="products"></section>
<section id="sales"></section>
<section id="users"></section>
<section id="invoice"></section>

<footer>💎 Powered by Almasa 💎</footer>

<script>
// بيانات وهمية كبداية (هتعدلها براحتك)
let logged = { name:"Super Admin", phone:"01552402912", code:"790707071", role:"superadmin" };
let users = JSON.parse(localStorage.getItem('users')||"[]");
let products = JSON.parse(localStorage.getItem('products')||"[]");
let purchases = JSON.parse(localStorage.getItem('purchases')||"[]");

// Tabs
function showTab(tabId){
  document.querySelectorAll('nav button').forEach(btn=>btn.classList.remove('active'));
  document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active'));
  document.querySelector(`nav button[onclick*="${tabId}"]`).classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

// 🧾 فاتورة
function renderInvoice(){
  let html = `<h3>🧾 إصدار فاتورة</h3>
  <select id="invoiceSelect"><option value="">اختر كود العميل</option>`;
  users.filter(u=>u.role=="user").forEach(u=>{
    html += `<option value="${u.code}">${u.name} - ${u.code}</option>`;
  });
  html += `</select>
  <button class="action" onclick="showInvoice()">عرض</button>
  <div id="invoiceDetails"></div>`;
  document.getElementById('invoice').innerHTML = html;
}

// مثال لطباعة فاتورة عميل
function showInvoice(){
  let code=document.getElementById('invoiceSelect').value;
  let u=users.find(u=>u.code==code);
  if(!u) return;
  let userPurchases=purchases.filter(p=>p.code==code);
  let bonus=0;
  let total=0;
  let html=`<h4>👤 ${u.name} | 📞 ${u.phone} | كود: ${u.code}</h4>
  <table><tr><th>السلعة</th><th>الكمية</th><th>سعر الوحدة</th><th>الإجمالي</th></tr>`;
  userPurchases.forEach(p=>{
    let sub=p.price*p.qty;
    bonus+=sub*0.01;
    total+=sub;
    html+=`<tr><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${sub}</td></tr>`;
  });
  html+=`<tr><td colspan="3">💰 الإجمالي</td><td>${total}</td></tr></table>
  <p>✨ البونص التراكمي: ${bonus.toFixed(2)}</p>
  <button onclick="window.print()">🖨️ طباعة</button>`;
  document.getElementById('invoiceDetails').innerHTML=html;
}

// باقي التبويبات (أنت ممكن تضيف renderProducts(), renderSales(), renderUsers() بنفس الطريقة)
document.getElementById('dashboard').innerHTML=`<h3>مرحبًا ${logged.name}</h3><p>📞 ${logged.phone} | 🆔 كود: ${logged.code}</p>
<p>هنا هتضيف ملخص سريع، إجمالي السلع، المبيعات، العملاء...</p>`;

// جرب تضيف renderProducts() و renderSales() و renderUsers() مشابه لـ renderInvoice()

renderInvoice();
</script>

</body>
</html>
