<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff;}
header { background:#6c757d; color:#fff; padding:12px; font-size:20px; text-align:center;}
nav { background:#f8f9fa; display:flex; justify-content:space-around; padding:8px; border-top:1px solid #ddd; border-bottom:1px solid #ddd;}
nav a { text-decoration:none; color:#333; font-size:14px;}
nav a:hover { color:#007bff;}
section { margin:10px auto; width:95%; max-width:800px;}
h3 { background:#007bff; color:#fff; padding:6px; border-radius:4px; font-size:17px;}
input[type=text], input[type=number], input[type=file] { width:95%; padding:6px; margin:4px 0; border:1px solid #ccc; border-radius:4px;}
button { background:#28a745; color:#fff; padding:6px 10px; border:none; border-radius:4px; cursor:pointer; margin:4px 0;}
button:hover { background:#218838;}
.logoutBtn { background:#dc3545; }
.logoutBtn:hover { background:#c82333;}
.restoreBtn { background:#ffc107; color:#000; }
.restoreBtn:hover { background:#e0a800;}
table { width:100%; border-collapse:collapse; margin-top:8px;}
td, th { border:1px solid #ccc; padding:4px; font-size:13px; text-align:center;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd; margin-top:10px;}
</style>
</head>
<body>

<header>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</header>

<nav>
  <a href="index.html">ğŸ  Ø§Ù„Ù…ØªØ¬Ø±</a>
  <a href="salesReport.html">ğŸ“Š Ù…Ø¨ÙŠØ¹Ø§ØªÙŠ</a>
  <a href="register.html">ğŸ”‘ Ø­Ø³Ø§Ø¨ÙŠ</a>
</nav>

<section id="adminSection">
  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø³ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ -->
</section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
let logged=JSON.parse(localStorage.getItem('loggedUser'));
let users=JSON.parse(localStorage.getItem('users')||"[]");
let products=JSON.parse(localStorage.getItem('products')||"[]");
let purchases=JSON.parse(localStorage.getItem('purchases')||"[]");
let bonus=parseFloat(localStorage.getItem('bonus')||"1");
let superAdminPass="790707071"; // ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø«Ø§Ø¨ØªØ©

function renderAdmin(){
  if(!logged || (logged.role!=="superadmin" && logged.role!=="admin")){
    document.getElementById('adminSection').innerHTML='<p>ğŸš« Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‡Ù†Ø§.</p>';
    return;
  }
  let html="";
  html+=`<h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${logged.name}</h3>
  <button class="logoutBtn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>`;

  if(logged.role==="superadmin"){
    html+=`
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</h3>
    <table>
      <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙƒÙˆØ¯</th></tr>`;
    users.forEach((u,idx)=>{
      if(u.role==="admin"){
        html+=`<tr>
          <td>${u.name}</td>
          <td><input type="text" value="${u.phone}" onchange="editAdmin(${idx},'phone',this.value)"></td>
          <td><input type="number" value="${u.code}" onchange="editAdmin(${idx},'code',this.value)"></td>
        </tr>`;
      }
    });
    html+=`</table>
    <h3>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨ÙˆÙ†Øµ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${bonus}%</h3>
    <input type="number" id="bonusInput" placeholder="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø³Ø¨Ø©">
    <button onclick="updateBonus()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø©</button>`;
  }

  html+=`
  <h3>Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
  <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©">
  <input type="number" id="pPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø³Ù„Ø¹Ø©">
  <input type="text" id="pDetails" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø¹Ø©">
  <input type="file" id="pImg">
  <button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ©</button>`;

  html+=`<h3>Ø§Ù„Ø³Ù„Ø¹ Ø§Ù„Ù…Ø¶Ø§ÙØ©</h3>`;
  if(products.length){
    html+=`<table>
    <tr><th>ØµÙˆØ±Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>ØªÙØ§ØµÙŠÙ„</th><th>Ø­Ø°Ù</th></tr>`;
    products.forEach((p,i)=>{
      html+=`<tr>
        <td><img src="${p.img||'https://via.placeholder.com/50'}" width="50"></td>
        <td>${p.name}</td>
        <td><input type="number" value="${p.price}" onchange="editProduct(${i},'price',this.value)"></td>
        <td>${p.details}</td>
        <td><button onclick="delProduct(${i})">ğŸ—‘ï¸</button></td>
      </tr>`;
    });
    html+=`</table>`;
  } else { html+=`<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù„Ø¹ Ø¨Ø¹Ø¯.</p>`; }

  html+=`<h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>`;
  if(purchases.length){
    html+=`<table>
    <tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„Ø³Ù„Ø¹Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>ØªÙ… Ø¥Ù„ØºØ§Ø¤Ù‡ØŸ</th></tr>`;
    purchases.forEach(p=>{
      html+=`<tr>
        <td>${p.name}</td>
        <td>${p.phone||''}</td>
        <td>${p.code}</td>
        <td>${p.product}</td>
        <td>${p.qty}</td>
        <td>${p.price}</td>
        <td>${p.date}</td>
        <td>${p.cancelled?'âœ…':'âŒ'}</td>
      </tr>`;
    });
    html+=`</table>
    <button class="restoreBtn" onclick="restorePurchases()">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>`;
  } else { html+=`<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø¹Ø¯.</p>`; }

  document.getElementById('adminSection').innerHTML=html;
}

function addProduct(){
  let name=document.getElementById('pName').value.trim();
  let price=parseFloat(document.getElementById('pPrice').value);
  let details=document.getElementById('pDetails').value.trim();
  let imgInput=document.getElementById('pImg');
  if(!name||!price||!details){ alert("â— Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª."); return;}
  let reader=new FileReader();
  reader.onload=function(e){
    products.push({name,price,details,img:e.target.result});
    localStorage.setItem('products', JSON.stringify(products));
    renderAdmin();
  };
  if(imgInput.files.length){ reader.readAsDataURL(imgInput.files[0]); }
  else { products.push({name,price,details,img:""}); localStorage.setItem('products', JSON.stringify(products)); renderAdmin();}
}

function delProduct(i){
  if(confirm("âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø³Ù„Ø¹Ø©ØŸ")){
    products.splice(i,1);
    localStorage.setItem('products', JSON.stringify(products));
    renderAdmin();
  }
}

function editProduct(i,field,value){
  products[i][field]=parseFloat(value)||products[i][field];
  localStorage.setItem('products', JSON.stringify(products));
}

function editAdmin(idx,field,value){
  users[idx][field]=value;
  localStorage.setItem('users', JSON.stringify(users));
}

function updateBonus(){
  let b=parseFloat(document.getElementById('bonusInput').value);
  if(isNaN(b)||b<0){ alert("â— Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© ØµØ­ÙŠØ­Ø©."); return;}
  localStorage.setItem('bonus',b);
  bonus=b;
  renderAdmin();
}

function restorePurchases(){
  let pass=prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…ÙŠÙ†:");
  if(pass===superAdminPass){
    purchases.forEach(p=>delete p.cancelled);
    localStorage.setItem('purchases', JSON.stringify(purchases));
    alert("âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­.");
    renderAdmin();
  } else { alert("âŒ ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§Ø·Ø¦Ø©."); }
}

function logout(){
  localStorage.removeItem('loggedUser');
  location.href='register.html';
}

renderAdmin();
</script>

</body>
</html>
