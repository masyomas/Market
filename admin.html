<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff; }
header { background:#6c757d; color:#fff; padding:12px; font-size:20px; text-align:center; position:sticky; top:0; }
nav { display:flex; justify-content:space-around; background:#f8f9fa; border-bottom:1px solid #ddd; }
nav button { flex:1; padding:8px; border:none; background:none; cursor:pointer; font-size:14px; }
nav button.active { background:#007bff; color:#fff; }
section { margin:10px auto; width:95%; max-width:800px; }
h3 { background:#007bff; color:#fff; padding:6px; border-radius:4px; font-size:17px; margin-top:10px; }
table { width:100%; border-collapse:collapse; margin-top:8px; }
td, th { border:1px solid #ccc; padding:4px; font-size:13px; }
button.action { background:#28a745; color:#fff; padding:4px 8px; border:none; border-radius:4px; cursor:pointer; margin:2px; }
button.action:hover { background:#218838; }
.delBtn { background:#dc3545; }
.delBtn:hover { background:#c82333; }
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; margin-top:10px; }
</style>
<link rel="manifest" href="manifest.json">
</head>
<body>

<header>ğŸ’ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</header>

<nav id="tabs">
  <button onclick="showTab('dashboard')" class="active">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
  <button onclick="showTab('products')">ğŸ“¦ Ø§Ù„Ø³Ù„Ø¹</button>
  <button onclick="showTab('sales')">ğŸ’° Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
  <button onclick="showTab('users')">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
  <button onclick="showTab('invoice')">ğŸ§¾ ÙØ§ØªÙˆØ±Ø©</button>
</nav>

<section id="content">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø¯Ø¦ÙŠØ©
let logged = JSON.parse(localStorage.getItem('loggedUser'));
let users = JSON.parse(localStorage.getItem('users')||"[]");
let products = JSON.parse(localStorage.getItem('products')||"[]");
let purchases = JSON.parse(localStorage.getItem('purchases')||"[]");
let bonus = parseFloat(localStorage.getItem('bonus')||"1");

if(!logged || logged.role!=="superadmin"){ document.getElementById('content').innerHTML='ğŸš« Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„.'; }
else { showTab('dashboard'); }

function showTab(tab){
  document.querySelectorAll('#tabs button').forEach(btn=>btn.classList.remove('active'));
  document.querySelector(`#tabs button[onclick*="${tab}"]`).classList.add('active');
  if(tab==='dashboard') renderDashboard();
  else if(tab==='products') renderProducts();
  else if(tab==='sales') renderSales();
  else if(tab==='users') renderUsers();
  else if(tab==='invoice') renderInvoice();
}

function renderDashboard(){
  let html=`<h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${logged.name} (Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†)</h3>
  <div>ğŸ“ Ù‡Ø§ØªÙÙƒ: ${logged.phone} | ÙƒÙˆØ¯Ùƒ: ${logged.code}</div>
  <button onclick="logout()" class="action delBtn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>`;
  document.getElementById('content').innerHTML=html;
}

function renderProducts(){
  let html=`<h3>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø¹</h3>
  <table><tr><th>Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø­Ø°Ù</th></tr>`;
  products.forEach((p,i)=>{
    html+=`<tr>
    <td>${p.name}</td>
    <td>${p.price}</td>
    <td><button onclick="delProduct(${i})" class="action delBtn">ğŸ—‘ï¸</button></td></tr>`;
  });
  html+=`</table>`;
  document.getElementById('content').innerHTML=html;
}

function renderSales(){
  let html=`<h3>ğŸ’° Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>`;
  if(purchases.length){
    html+=`<table>
    <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>`;
    purchases.forEach(p=>{
      html+=`<tr><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${p.qty*p.price}</td></tr>`;
    });
    html+=`</table>`;
  }else{ html+="<p>ğŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø¹Ø¯.</p>"; }
  document.getElementById('content').innerHTML=html;
}

function renderUsers(){
  let html=`<h3>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙˆØ§Ù„Ù…Ø¯ÙŠØ±ÙˆÙ†</h3>
  <table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„Ø¯ÙˆØ±</th></tr>`;
  users.forEach(u=>{
    html+=`<tr><td>${u.name}</td><td>${u.phone}</td><td>${u.code}</td><td>${u.role}</td></tr>`;
  });
  html+=`</table>`;
  document.getElementById('content').innerHTML=html;
}

function renderInvoice(){
  let html=`<h3>ğŸ§¾ Ø¥ØµØ¯Ø§Ø± ÙØ§ØªÙˆØ±Ø©</h3>
  <select id="invoiceUser"><option value="">Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>`;
  users.filter(u=>u.role=="user").forEach(u=>{
    html+=`<option value="${u.code}">${u.name} - ÙƒÙˆØ¯:${u.code}</option>`;
  });
  html+=`</select>
  <button onclick="showInvoice()" class="action">Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
  <div id="invoiceDetails"></div>`;
  document.getElementById('content').innerHTML=html;
}

function showInvoice(){
  let code=document.getElementById('invoiceUser').value;
  if(!code) return;
  let u=users.find(u=>u.code==code);
  let userPurchases=purchases.filter(p=>p.code==code);
  let total=userPurchases.reduce((sum,p)=>sum+p.qty*p.price,0);
  let html=`<div>ğŸ‘¤ ${u.name} | ğŸ“ ${u.phone} | ÙƒÙˆØ¯: ${u.code}</div>
  <table><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>`;
  userPurchases.forEach(p=>{
    html+=`<tr><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${p.qty*p.price}</td></tr>`;
  });
  html+=`<tr><td colspan="3">ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td><td>${total}</td></tr></table>
  <button onclick="window.print()" class="action">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>`;
  document.getElementById('invoiceDetails').innerHTML=html;
}

function delProduct(i){
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø³Ù„Ø¹Ø©ØŸ")){
    products.splice(i,1);
    localStorage.setItem('products', JSON.stringify(products));
    renderProducts();
  }
}

function logout(){
  localStorage.removeItem('loggedUser');
  location.href='register.html';
}

// ØªØ«Ø¨ÙŠØª ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø©
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
