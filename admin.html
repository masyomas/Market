<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; text-align:center; background:#fff;}
header { background:#6c757d; color:#fff; padding:15px; font-size:22px;}
nav { background:#6c757d; color:#fff; padding:8px;}
nav a { color:#fff; text-decoration:none; margin:0 5px; font-size:14px;}
nav a:hover { text-decoration:underline;}
section { margin:15px auto; width:95%; max-width:900px;}
h3 { margin-top:20px; }
table { width:100%; border-collapse:collapse; margin-top:10px;}
th, td { border:1px solid #ddd; padding:6px; font-size:13px;}
.green { color:green; font-weight:bold;}
.red { color:red; font-weight:bold;}
input, select { padding:5px; margin:5px; width:60%; max-width:250px;}
button { padding:5px 10px; margin:5px; font-size:13px; background:#6c757d; color:#fff; border:none; border-radius:4px; cursor:pointer;}
button:hover { background:#555;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</header>

<nav>
  <a href="index.html">ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</a> |
  <a href="register.html">ğŸ“ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</a> |
  <a href="myPurchases.html">ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</a> |
  <a href="#" onclick="logoutUser()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
</nav>

<section id="adminSection" style="display:none;">

  <h3>ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h3>
  <table>
    <tr>
      <th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙØ¹</th><th>Ø§Ù„Ø¨ÙˆÙ†Øµ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø®ÙŠØ§Ø±Ø§Øª</th>
    </tr>
    <tbody id="userTable"></tbody>
  </table>

  <h3>â• Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
  <p>ğŸ“Œ Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙÙŠ Ù…Ø¬Ù„Ø¯ picture/ Ø«Ù… Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</p>
  <input type="text" id="pname" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©"><br/>
  <input type="number" id="pprice" placeholder="Ø§Ù„Ø³Ø¹Ø±"><br/>
  <input type="text" id="pdetails" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø¹Ø©"><br/>
  <input type="text" id="pimg" placeholder="Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø«Ù„Ø§Ù‹ picture/item.jpg)"><br/>
  <button onclick="addProduct()">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù„Ø¹Ø©</button>

  <div id="superOnly" style="display:none;">
    <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…ÙŠÙ†</h3>
    <input type="number" id="bonus" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨ÙˆÙ†Øµ (%)"><br/>
    <button onclick="changeBonus()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨Ø©</button><br/>
    <input type="email" id="adminEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙŠØµÙ„Ù‡ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"><br/>
    <button onclick="changeEmail()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙŠØ¯</button>

    <h3>ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</h3>
    <table>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
      <tbody id="adminTable"></tbody>
    </table>
  </div>

</section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…ÙŠÙ†
let superAdmin = { phone:"01552402913", code:790707071 };
let loggedUser = JSON.parse(localStorage.getItem('loggedUser'));
let admins = JSON.parse(localStorage.getItem('admins')||"[]");

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
if(!loggedUser){ location.href="register.html"; }
else if(loggedUser.code === superAdmin.code){
  document.getElementById('adminSection').style.display="block";
  document.getElementById('superOnly').style.display="block";
  loadAdmins();
}else if(admins.find(a=>a.code===loggedUser.code)){
  document.getElementById('adminSection').style.display="block";
}else{
  alert("âŒ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„"); location.href="register.html";
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
let users = JSON.parse(localStorage.getItem('users')||"[]");
let purchases = JSON.parse(localStorage.getItem('purchases')||"[]");
let bonusPerc = parseFloat(localStorage.getItem('bonusPercentage')||"0");

let html="";
users.forEach((u)=>{
  let userPurchases = purchases.filter(p=>p.userCode===u.code);
  let total = userPurchases.reduce((sum,p)=>sum+parseFloat(p.price),0);
  let bonus = total * bonusPerc/100;
  let active = (JSON.parse(localStorage.getItem('loggedUser'))?.code===u.code) ? '<span class="green">Ù†Ø´Ø·</span>' : '<span class="red">ØºÙŠØ± Ù†Ø´Ø·</span>';

  html+=`<tr>
  <td>${u.name}</td>
  <td>${u.code}</td>
  <td>${userPurchases.length}</td>
  <td>${total} Ø¬Ù†ÙŠÙ‡</td>
  <td>${bonus.toFixed(2)}</td>
  <td>${active}</td>
  <td>
    <button onclick="deletePurchases(${u.code})">ğŸ—‘ Ø­Ø°Ù Ù…Ø´ØªØ±ÙŠØ§Øª</button>
    ${loggedUser.code===superAdmin.code?`<button onclick="deleteUser(${u.code})">âŒ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„</button>`:""}
  </td>
  </tr>`;
});
document.getElementById('userTable').innerHTML=html;

// Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
function addProduct(){
  let name=document.getElementById('pname').value.trim();
  let price=parseFloat(document.getElementById('pprice').value.trim());
  let details=document.getElementById('pdetails').value.trim();
  let img=document.getElementById('pimg').value.trim() || "picture/empty.jpg";
  if(!name || !price){ alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±"); return;}
  let products=JSON.parse(localStorage.getItem('products')||"[]");
  products.push({name,price,details,img});
  localStorage.setItem('products',JSON.stringify(products));
  alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù„Ø¹Ø©");
}

// ØªØºÙŠÙŠØ± Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨ÙˆÙ†Øµ
function changeBonus(){
  let perc=parseFloat(document.getElementById('bonus').value.trim());
  if(isNaN(perc)||perc<0){ alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© ØµØ­ÙŠØ­Ø©"); return;}
  localStorage.setItem('bonusPercentage',perc);
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨Ø©");
}

// ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯
function changeEmail(){
  let email=document.getElementById('adminEmail').value.trim();
  if(!email.includes('@')){ alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­"); return;}
  localStorage.setItem('adminEmail',email);
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙŠØ¯");
}

// Ø­Ø°Ù Ù…Ø´ØªØ±ÙŠØ§Øª Ø¹Ù…ÙŠÙ„
function deletePurchases(code){
  let all=JSON.parse(localStorage.getItem('purchases')||"[]");
  all=all.filter(p=>p.userCode!==code);
  localStorage.setItem('purchases',JSON.stringify(all));
  alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª");
  location.reload();
}

// Ø­Ø°Ù Ø¹Ù…ÙŠÙ„
function deleteUser(code){
  if(!confirm("âŒ ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")) return;
  let users=JSON.parse(localStorage.getItem('users')||"[]");
  users=users.filter(u=>u.code!==code);
  localStorage.setItem('users',JSON.stringify(users));
  deletePurchases(code);
  alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„");
  location.reload();
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡ ÙˆØ¹Ø±Ø¶Ù‡Ù…
function loadAdmins(){
  let html="";
  admins.forEach((a,idx)=>{
    html+=`<tr>
    <td>${a.name}</td>
    <td><input value="${a.phone}" onchange="updateAdmin(${idx},'phone',this.value)"></td>
    <td><input value="${a.code}" onchange="updateAdmin(${idx},'code',this.value)"></td>
    <td></td>
    </tr>`;
  });
  document.getElementById('adminTable').innerHTML=html;
}

// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¯ÙŠØ±
function updateAdmin(idx, field, value){
  admins[idx][field]= field==='code'? parseInt(value): value;
  localStorage.setItem('admins', JSON.stringify(admins));
  alert("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
}

// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
function logoutUser(){
  localStorage.removeItem('loggedUser');
  alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  location.href="register.html";
}

// Ø§Ù„ØªÙ‚Ø§Ø· ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰
window.addEventListener('storage',function(e){
  if(e.key==='loggedUser' && e.newValue===null){
    alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰");
    location.href='register.html';
  }
});
</script>

</body>
</html>
