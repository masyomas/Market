<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff; }
header { background:#6c757d; color:#fff; padding:12px; font-size:20px; text-align:center; }
nav { background:#f8f9fa; display:flex; justify-content:space-around; padding:8px; border-top:1px solid #ddd; border-bottom:1px solid #ddd; }
nav a { text-decoration:none; color:#333; font-size:14px; }
nav a:hover { color:#007bff; }
section { margin:10px auto; width:95%; max-width:900px; }
h3 { background:#007bff; color:#fff; padding:6px; border-radius:4px; font-size:17px; }
input[type=text], input[type=number], input[type=file] { width:95%; padding:6px; margin:4px 0; border:1px solid #ccc; border-radius:4px; }
button { background:#28a745; color:#fff; padding:6px 10px; border:none; border-radius:4px; cursor:pointer; margin:4px 2px; }
button:hover { background:#218838; }
.logoutBtn { background:#dc3545; }
.logoutBtn:hover { background:#c82333; }
table { width:100%; border-collapse:collapse; margin-top:8px; }
th, td { border:1px solid #ccc; padding:4px; font-size:13px; text-align:center; }
th { cursor:pointer; background:#f1f1f1; }
tr:nth-child(even) { background:#fafafa; }
.color-0{background:#e0f7fa;} .color-1{background:#f1f8e9;} .color-2{background:#fff3e0;} .color-3{background:#fce4ec;} .color-4{background:#ede7f6;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd; margin-top:10px; }
</style>
</head>
<body><header>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</header><nav>
  <a href="#" onclick="showTab('products')">ğŸ“¦ Ø§Ù„Ø³Ù„Ø¹</a>
  <a href="#" onclick="showTab('sales')">ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a>
  <a href="#" onclick="showTab('invoice')">ğŸ§¾ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</a>
  <a href="#" onclick="showTab('admins')">ğŸ‘¥ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</a>
  <button class="logoutBtn" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</nav><section id="adminContent"></section><footer>ğŸ’ Powered by Almasa ğŸ’</footer><script>
let users=JSON.parse(localStorage.getItem('users')||"[]");
let products=JSON.parse(localStorage.getItem('products')||"[]");
let purchases=JSON.parse(localStorage.getItem('purchases')||"[]");
let logged=JSON.parse(localStorage.getItem('loggedUser'));
let bonus=parseFloat(localStorage.getItem('bonus')||"1");

if(!logged || (logged.role!=="superadmin" && logged.role!=="admin")){
  document.getElementById('adminContent').innerHTML='<p>ğŸš« Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>';
}else{
  showTab('products');
}

function showTab(tab){
  if(tab=="products"){ renderProducts(); }
  else if(tab=="sales"){ renderSales(); }
  else if(tab=="invoice"){ renderInvoiceTab(); }
  else if(tab=="admins" && logged.role=="superadmin"){ renderAdmins(); }
  else{ document.getElementById('adminContent').innerHTML='<p>ğŸš« Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„.</p>'; }
}

function renderProducts(){
  let html=`<h3>Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø¹Ø©</h3>
  <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©">
  <input type="number" id="pPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø³Ù„Ø¹Ø©">
  <input type="text" id="pDetails" placeholder="ØªÙØ§ØµÙŠÙ„">
  <input type="file" id="pImg">
  <button onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ©</button>
  <h3>Ø§Ù„Ø³Ù„Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>`;
  if(products.length){
    html+=`<table><tr><th>ØµÙˆØ±Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>ØªÙØ§ØµÙŠÙ„</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr>`;
    products.forEach((p,i)=>{
      html+=`<tr>
        <td><img src="${p.img||'https://via.placeholder.com/50'}" width="50"></td>
        <td>${p.name}</td>
        <td><input type='number' value='${p.price}' onchange='editProduct(${i},"price",this.value)'></td>
        <td>${p.details}</td>
        <td><button onclick='editProduct(${i})'>âœï¸</button></td>
        <td><button onclick='delProduct(${i})'>ğŸ—‘ï¸</button></td></tr>`;
    });
    html+='</table>';
  }else{ html+='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù„Ø¹.</p>'; }
  document.getElementById('adminContent').innerHTML=html;
}

function addProduct(){
  let name=document.getElementById('pName').value.trim();
  let price=parseFloat(document.getElementById('pPrice').value);
  let details=document.getElementById('pDetails').value.trim();
  let imgInput=document.getElementById('pImg');
  let img="";
  if(!name||!price||!details){ alert("â— Ø£ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }
  if(imgInput.files.length){
    let reader=new FileReader();
    reader.onload=e=>{ products.push({name,price,details,img:e.target.result}); saveProducts(); };
    reader.readAsDataURL(imgInput.files[0]);
  }else{ products.push({name,price,details,img}); saveProducts(); }
}
function saveProducts(){ localStorage.setItem('products',JSON.stringify(products)); renderProducts(); }
function editProduct(i,field,val){ if(field){ products[i][field]=val; saveProducts(); } }
function delProduct(i){ if(confirm("âš ï¸ Ø­Ø°Ù Ø§Ù„Ø³Ù„Ø¹Ø©ØŸ")){ products.splice(i,1); saveProducts(); } }

function renderSales(){
  let html='<h3>ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>';
  if(purchases.length){
    html+='<table><tr><th onclick="sortSales(\'name\')">Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø³Ù„Ø¹Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>';
    purchases.forEach((p,i)=>{
      let u=users.find(u=>u.code==p.code) ||{};
      let subtotal=p.qty*p.price;
      let colorIndex=p.code%5;
      html+=`<tr class='color-${colorIndex}'><td>${u.name||'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td><td>${p.code}</td><td>${u.phone||''}</td><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${subtotal}</td><td>${p.date}</td></tr>`;
    });
    html+='</table>';
    html+='<button onclick="clearSales()">ğŸ—‘ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>';
  }else{ html+='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø¹Ø¯.</p>'; }
  document.getElementById('adminContent').innerHTML=html;
}
function clearSales(){
  let pass=prompt("ğŸ”‘ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†");
  if(pass=="790707071"){ purchases=[]; localStorage.setItem('purchases','[]'); renderSales(); }
  else{ alert("âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©"); }
}

function renderInvoiceTab(){
  let html='<h3>ğŸ§¾ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3><select onchange="showInvoice(this.value)"><option>Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>';
  users.forEach(u=>{ html+=`<option value='${u.code}'>${u.name} (${u.code})</option>`; });
  html+='</select><div id="invoiceDetails"></div>';
  document.getElementById('adminContent').innerHTML=html;
}
function showInvoice(code){
  let u=users.find(u=>u.code==code);
  if(!u) return;
  let userPurchases=purchases.filter(p=>p.code==code);
  let html=`<div><div>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${u.name}</div><div>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${u.phone}</div><div>ğŸ§¾ Ø§Ù„ÙƒÙˆØ¯: ${u.code}</div><div>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString('ar-EG')}</div>
  <table><tr><th>Ø§Ù„Ø³Ù„Ø¹Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>`;
  let total=0;
  userPurchases.forEach(p=>{
    let subtotal=p.qty*p.price;
    total+=subtotal;
    html+=`<tr><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${subtotal}</td></tr>`;
  });
  html+=`<tr><td colspan='3'>ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td><td>${total}</td></tr></table>
  <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button></div>`;
  document.getElementById('invoiceDetails').innerHTML=html;
}

function renderAdmins(){
  let html='<h3>ğŸ‘¥ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</h3><table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙƒÙˆØ¯</th></tr>';
  users.filter(u=>u.role==='admin').forEach((u,i)=>{
    html+=`<tr><td><input value='${u.name}' onchange='editAdmin(${i},"name",this.value)'></td>
    <td><input value='${u.phone}' onchange='editAdmin(${i},"phone",this.value)'></td>
    <td><input value='${u.code}' onchange='editAdmin(${i},"code",this.value)'></td></tr>`;
  });
  html+='</table>';
  document.getElementById('adminContent').innerHTML=html;
}
function editAdmin(i,field,val){
  let admins=users.filter(u=>u.role==='admin');
  admins[i][field]=val;
  users=users.map(u=>u.role==='admin'?admins.shift():u);
  localStorage.setItem('users', JSON.stringify(users));
}

function logout(){ localStorage.removeItem('loggedUser'); location.href='register.html'; }
</script></body>
</html>
