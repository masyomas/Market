<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family:'Tahoma',sans-serif; margin:0; background:#fff;}
header { background:#6c757d; color:#fff; padding:10px; font-size:18px; text-align:center; position:sticky; top:0; z-index:10;}
nav { background:#f8f9fa; display:flex; justify-content:space-around; padding:6px; border-top:1px solid #ddd; border-bottom:1px solid #ddd;}
nav a { text-decoration:none; color:#333; font-size:14px;}
nav a:hover { color:#007bff;}
section { margin:10px auto; width:95%; max-width:900px;}
h3 { background:#007bff; color:#fff; padding:6px; border-radius:4px; font-size:16px; margin-top:10px;}
table { width:100%; border-collapse:collapse; margin-top:8px;}
td, th { border:1px solid #ccc; padding:4px; font-size:13px;}
button { background:#28a745; color:#fff; padding:4px 8px; border:none; border-radius:4px; cursor:pointer; margin:3px;}
button:hover { background:#218838;}
.delBtn { background:#dc3545; }
.delBtn:hover { background:#c82333;}
input[type=text], input[type=number], input[type=password], select { width:95%; padding:6px; margin:4px 0; border:1px solid #ccc; border-radius:4px;}
label { font-size:13px; }
footer { background:#f1f1f1; text-align:center; padding:6px; font-size:12px; color:#777; border-top:1px solid #ddd; margin-top:10px;}
</style>
</head>
<body>

<header>ğŸ’ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | <a href="index.html">ğŸª Ø§Ù„Ù…ØªØ¬Ø±</a></header>

<nav>
  <a href="admin.html">ğŸ› ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
  <a href="mySales.html">ğŸ“Š Ù…Ø¨ÙŠØ¹Ø§ØªÙŠ</a>
  <a href="register.html">ğŸ”‘ Ø­Ø³Ø§Ø¨ÙŠ</a>
</nav>

<section id="adminContent">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
let logged=JSON.parse(localStorage.getItem('loggedUser'));
let users=JSON.parse(localStorage.getItem('users')||"[]");
let purchases=JSON.parse(localStorage.getItem('purchases')||"[]");
let products=JSON.parse(localStorage.getItem('products')||"[]");

// Ø±Ù†Ø¯Ø± Ø§Ù„ØµÙØ­Ø©
function renderAdmin(){
  if(!logged || logged.role!=="superadmin"){
    document.getElementById('adminContent').innerHTML='<p>ğŸš« Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>';
    return;
  }

  let html=`
  <h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${logged.name}</h3>
  <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

  <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ± Ø¬Ø¯ÙŠØ¯</h3>
  <input type="text" id="adminName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±">
  <input type="text" id="adminPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="addAdmin()">Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ±</button>

  <h3>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
  <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©">
  <input type="number" id="pQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
  <input type="number" id="pPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©">
  <button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø¹Ø©</button>
  <table>
  <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø­Ø°Ù</th></tr>`;
  products.forEach((p,i)=>{
    html+=`<tr>
      <td>${p.name}</td>
      <td>${p.qty}</td>
      <td>${p.price}</td>
      <td><button class="delBtn" onclick="delProduct(${i})">ğŸ—‘ï¸</button></td>
    </tr>`;
  });
  html+=`</table>

  <h3>ğŸ§¾ Ø¥ØµØ¯Ø§Ø± ÙØ§ØªÙˆØ±Ø©</h3>
  <select id="invoiceSelect">
    <option value="">Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>`;
  users.filter(u=>u.role=="user").forEach(u=>{
    html+=`<option value="${u.code}">${u.name} - ÙƒÙˆØ¯:${u.code}</option>`;
  });
  html+=`</select>
  <button onclick="showInvoice()">Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
  <div id="invoiceDetails"></div>

  <h3>ğŸ“Š Ù…Ø¨ÙŠØ¹Ø§ØªÙŠ</h3>`;
  // ØªÙ‚Ø±ÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ù„ÙƒÙ„ Ø³Ù„Ø¹Ø©
  let salesReport = {};
  purchases.forEach(p=>{
    if(!salesReport[p.product]) salesReport[p.product]={qty:0, total:0, price:p.price};
    salesReport[p.product].qty+=p.qty;
    salesReport[p.product].total+=p.qty*p.price;
  });
  html+=`<table>
  <tr><th>Ø§Ù„Ø³Ù„Ø¹Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th><th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th></tr>`;
  products.forEach(prod=>{
    let sold=salesReport[prod.name]?.qty||0;
    let remaining=prod.qty - sold;
    html+=`<tr>
      <td>${prod.name}</td>
      <td>${sold}</td>
      <td>${prod.price}</td>
      <td>${salesReport[prod.name]?.total||0}</td>
      <td>${remaining}</td>
    </tr>`;
  });
  html+=`</table>`;

  document.getElementById('adminContent').innerHTML=html;
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ±
function addAdmin(){
  let name=document.getElementById('adminName').value.trim();
  let phone=document.getElementById('adminPhone').value.trim();
  let pass=document.getElementById('adminPass').value.trim();
  if(!name||!phone||!pass){ alert("â— Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }
  if(users.find(u=>u.phone===phone)){ alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø³ØªØ®Ø¯Ù…"); return; }
  let code=Math.floor(2001+Math.random()*7999);
  users.push({name,phone,password:pass,code,role:"admin"});
  localStorage.setItem('users',JSON.stringify(users));
  alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯ÙŠØ±.");
  renderAdmin();
}

// Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø¹Ø©
function addProduct(){
  let name=document.getElementById('pName').value.trim();
  let qty=parseInt(document.getElementById('pQty').value);
  let price=parseFloat(document.getElementById('pPrice').value);
  if(!name||!qty||!price){ alert("â— Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }
  products.push({name,qty,price});
  localStorage.setItem('products',JSON.stringify(products));
  renderAdmin();
}

// Ø­Ø°Ù Ø³Ù„Ø¹Ø©
function delProduct(i){
  if(confirm("âš ï¸ Ø­Ø°Ù Ø§Ù„Ø³Ù„Ø¹Ø©ØŸ")){
    products.splice(i,1);
    localStorage.setItem('products',JSON.stringify(products));
    renderAdmin();
  }
}

// Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
function showInvoice(){
  let code=document.getElementById('invoiceSelect').value;
  if(!code) return;
  let u=users.find(u=>u.code==code);
  let userPurchases=purchases.filter(p=>p.code==code);
  let bonus = userPurchases.reduce((sum,p)=>sum+p.qty,0)*0.1; // Ù…Ø«Ø§Ù„ Ø¨ÙˆÙ†Øµ

  let html=`<div style="margin-top:10px; text-align:right;">
  <div>ğŸª Ø§Ù„Ù…ØªØ¬Ø±: Almasa</div>
  <div>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${u.name}</div>
  <div>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${u.phone}</div>
  <div>ğŸ§¾ Ø§Ù„ÙƒÙˆØ¯: ${u.code}</div>
  <div>ğŸ’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨ÙˆÙ†Øµ: ${bonus.toFixed(2)}</div>
  <table>
  <tr><th>Ø§Ù„Ø³Ù„Ø¹Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>`;
  let total=0;
  userPurchases.forEach(p=>{
    let subtotal=p.qty*p.price;
    total+=subtotal;
    html+=`<tr><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${subtotal}</td></tr>`;
  });
  html+=`<tr><td colspan="3">ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td><td>${total}</td></tr></table>
  <footer>ğŸ’ Powered by Almasa ğŸ’</footer>
  <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button></div>`;
  document.getElementById('invoiceDetails').innerHTML=html;
}

// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
function logout(){
  localStorage.removeItem('loggedUser');
  location.href='register.html';
}

renderAdmin();
</script>

</body>
</html>
