<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff;}
header { background:#6c757d; color:#fff; padding:12px; font-size:18px; text-align:center;}
nav { display:flex; justify-content:space-around; background:#007bff; }
nav button { flex:1; padding:8px; background:#007bff; color:#fff; border:none; font-size:14px; cursor:pointer; }
nav button.active { background:#0056b3; }
section { display:none; padding:10px; }
section.active { display:block; }
table { width:100%; border-collapse:collapse; margin-top:8px;}
th, td { border:1px solid #ccc; padding:4px; font-size:13px;}
input, select { width:95%; padding:6px; margin:4px 0; border:1px solid #ccc; border-radius:4px;}
button.action { background:#28a745; color:#fff; padding:6px 10px; border:none; border-radius:4px; cursor:pointer; margin:4px 0;}
button.action:hover { background:#218838;}
.delBtn { background:#dc3545; }
.delBtn:hover { background:#c82333;}
footer { background:#f1f1f1; text-align:center; padding:6px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>ğŸ’ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</header>

<nav>
  <button onclick="showTab('dashboard')" class="active">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
  <button onclick="showTab('products')">ğŸ“¦ Ø§Ù„Ø³Ù„Ø¹ ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
  <button onclick="showTab('sales')">ğŸ’° Ù…Ø¨ÙŠØ¹Ø§ØªÙŠ</button>
  <button onclick="showTab('users')">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†</button>
  <button onclick="showTab('invoice')">ğŸ§¾ ÙØ§ØªÙˆØ±Ø©</button>
</nav>

<section id="dashboard" class="active">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</section>
<section id="products"></section>
<section id="sales"></section>
<section id="users"></section>
<section id="invoice"></section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ÙƒØ¨Ø¯Ø§ÙŠØ© (Ù‡ØªØ¹Ø¯Ù„Ù‡Ø§ Ø¨Ø±Ø§Ø­ØªÙƒ)
let logged = { name:"Super Admin", phone:"01552402912", code:"790707071", role:"superadmin" };
let users = JSON.parse(localStorage.getItem('users')||"[]");
let products = JSON.parse(localStorage.getItem('products')||"[]");
let purchases = JSON.parse(localStorage.getItem('purchases')||"[]");

// Tabs
function showTab(tabId){
  document.querySelectorAll('nav button').forEach(btn=>btn.classList.remove('active'));
  document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active'));
  document.querySelector(`nav button[onclick*="${tabId}"]`).classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

// ğŸ§¾ ÙØ§ØªÙˆØ±Ø©
function renderInvoice(){
  let html = `<h3>ğŸ§¾ Ø¥ØµØ¯Ø§Ø± ÙØ§ØªÙˆØ±Ø©</h3>
  <select id="invoiceSelect"><option value="">Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>`;
  users.filter(u=>u.role=="user").forEach(u=>{
    html += `<option value="${u.code}">${u.name} - ${u.code}</option>`;
  });
  html += `</select>
  <button class="action" onclick="showInvoice()">Ø¹Ø±Ø¶</button>
  <div id="invoiceDetails"></div>`;
  document.getElementById('invoice').innerHTML = html;
}

// Ù…Ø«Ø§Ù„ Ù„Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø¹Ù…ÙŠÙ„
function showInvoice(){
  let code=document.getElementById('invoiceSelect').value;
  let u=users.find(u=>u.code==code);
  if(!u) return;
  let userPurchases=purchases.filter(p=>p.code==code);
  let bonus=0;
  let total=0;
  let html=`<h4>ğŸ‘¤ ${u.name} | ğŸ“ ${u.phone} | ÙƒÙˆØ¯: ${u.code}</h4>
  <table><tr><th>Ø§Ù„Ø³Ù„Ø¹Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>`;
  userPurchases.forEach(p=>{
    let sub=p.price*p.qty;
    bonus+=sub*0.01;
    total+=sub;
    html+=`<tr><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${sub}</td></tr>`;
  });
  html+=`<tr><td colspan="3">ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td><td>${total}</td></tr></table>
  <p>âœ¨ Ø§Ù„Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ: ${bonus.toFixed(2)}</p>
  <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>`;
  document.getElementById('invoiceDetails').innerHTML=html;
}

// Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Ø£Ù†Øª Ù…Ù…ÙƒÙ† ØªØ¶ÙŠÙ renderProducts(), renderSales(), renderUsers() Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©)
document.getElementById('dashboard').innerHTML=`<h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${logged.name}</h3><p>ğŸ“ ${logged.phone} | ğŸ†” ÙƒÙˆØ¯: ${logged.code}</p>
<p>Ù‡Ù†Ø§ Ù‡ØªØ¶ÙŠÙ Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ØŒ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ø¹ØŒ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŒ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...</p>`;

// Ø¬Ø±Ø¨ ØªØ¶ÙŠÙ renderProducts() Ùˆ renderSales() Ùˆ renderUsers() Ù…Ø´Ø§Ø¨Ù‡ Ù„Ù€ renderInvoice()

renderInvoice();
</script>

</body>
</html>
