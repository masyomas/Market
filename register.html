<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff; text-align:center; direction:rtl;}
header { background:#6c757d; color:#fff; padding:15px; font-size:22px;}
nav { background:#6c757d; color:#fff; padding:8px; text-align:right;}
nav a { color:#fff; text-decoration:none; margin:0 5px; font-size:15px;}
nav a:hover { text-decoration:underline;}
main { margin:20px;}
input { width:70%; padding:6px; margin:6px; font-size:14px;}
button { margin-top:10px; padding:6px 15px; font-size:14px; background:#6c757d; color:#fff; border:none; border-radius:4px; cursor:pointer;}
button:hover { background:#555;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</header>

<nav>
  <a href="index.html">ğŸ¬ Ø§Ù„Ù…ØªØ¬Ø±</a> |
  <a href="register.html">ğŸ“ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</a> |
  <a href="myPurchases.html">ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</a> |
  <a href="#" onclick="logoutUser()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
</nav>

<main>
  <h3>Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ØªØ³Ø¬ÙŠÙ„</h3>
  <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ"><br/>
  <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€0)"><br/>
  <input type="number" id="code" placeholder="ÙƒÙˆØ¯ Ø¨ÙŠÙ† 2006 Ùˆ 9998"><br/>
  <button onclick="registerUser()">âœ… ØªØ³Ø¬ÙŠÙ„</button>
</main>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// âœ… Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: Ù‡Ù„ ÙÙŠÙ‡ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©ØŸ
let loggedUser = JSON.parse(localStorage.getItem('loggedUser'));
if(loggedUser){
  alert("âœ… Ø£Ù†Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³Ù…: " + loggedUser.name);
  location.href = "index.html";
}

// ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
function registerUser(){
  let name = document.getElementById('name').value.trim();
  let phone = document.getElementById('phone').value.trim();
  let code = parseInt(document.getElementById('code').value.trim());

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  if(!/^[\u0600-\u06FF\s]{3,}$/.test(name) || name.split(" ").length < 3){
    alert("âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©");
    return;
  }
  if(!/^0\d{10}$/.test(phone)){
    alert("âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 11 Ø±Ù‚Ù… ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€0");
    return;
  }
  if(isNaN(code) || code<2006 || code>9998){
    alert("âš ï¸ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 2006 Ùˆ 9998");
    return;
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±
  let users = JSON.parse(localStorage.getItem('users') || "[]");
  if(users.find(u=>u.name===name)){
    alert("âš ï¸ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„");
    return;
  }
  if(users.find(u=>u.phone===phone)){
    alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„");
    return;
  }
  if(users.find(u=>u.code===code)){
    alert("âš ï¸ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„");
    return;
  }

  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  let newUser = { name:name, phone:phone, code:code };
  users.push(newUser);
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('loggedUser', JSON.stringify(newUser));
  alert("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒØŒ " + name);
  location.href = "index.html";
}

// ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logoutUser(){
  localStorage.removeItem('loggedUser');
  alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  location.href = "register.html";
}

// ğŸ§© Ø§Ù„ØªÙ‚Ø§Ø· ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰
window.addEventListener('storage', function(e){
  if(e.key === 'loggedUser' && e.newValue === null){
    alert("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ø£Ø®Ø±Ù‰");
    location.href = "register.html";
  }
});
</script>

</body>
</html>
