<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”‘ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff; text-align:center;}
header { background:#6c757d; color:#fff; padding:12px; font-size:22px;}
nav { background:#f8f9fa; display:flex; justify-content:space-around; padding:8px 0; border-top:1px solid #ddd; border-bottom:1px solid #ddd;}
nav a { text-decoration:none; color:#333; font-size:14px;}
nav a:hover { color:#007bff; }
section { margin:10px auto; width:90%; max-width:400px;}
input[type=text], input[type=number], input[type=password] { width:90%; padding:8px; margin:5px 0; border:1px solid #ccc; border-radius:4px;}
button { background:#007bff; color:#fff; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; margin:5px 0;}
button:hover { background:#0056b3;}
.logoutBtn { background:#dc3545; }
.logoutBtn:hover { background:#c82333;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd; margin-top:10px;}
</style>
</head>
<body>

<header>ğŸ”‘ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</header>

<nav>
  <a href="index.html">ğŸ  Ø§Ù„Ù…ØªØ¬Ø±</a>
  <a href="myPurchases.html">ğŸ›’ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</a>
  <a href="register.html">ğŸ”‘ Ø­Ø³Ø§Ø¨ÙŠ</a>
</nav>

<section>
  <div id="formsContainer"></div>
</section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
// ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© + Ø¥Ø¶Ø§ÙØ© Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù† Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
if (!localStorage.getItem('usersCleaned')) {
  localStorage.removeItem('users');
  let superAdmin = { name:"Super Admin", phone:"01552402912", password:"790707071", code:7907, role:"superadmin" };
  localStorage.setItem('users', JSON.stringify([superAdmin]));
  localStorage.setItem('usersCleaned', "yes");
}

// Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
let users = JSON.parse(localStorage.getItem('users') || "[]");
let logged = JSON.parse(localStorage.getItem('loggedUser'));

// Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
function renderForms(){
  let html = "";
  if (!logged){
    html+=`
    <h3>ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
    <input type="text" id="newName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ">
    <input type="text" id="newPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <input type="password" id="newPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <button onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>

    <h3>Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <input type="text" id="loginPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <input type="password" id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    `;
  }else{
    html+=`
    <h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${logged.name}</h3>
    <button class="logoutBtn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    `;
  }
  document.getElementById('formsContainer').innerHTML = html;
}

// ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
function register(){
  let name = document.getElementById('newName').value.trim();
  let phone = document.getElementById('newPhone').value.trim();
  let password = document.getElementById('newPass').value.trim();

  let nameOk = /^[\u0600-\u06FF ]{7,}$/.test(name);
  let phoneOk = /^0\d{10}$/.test(phone);
  let passOk = password.length >= 4;

  if (!nameOk) { alert("â— Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø«Ù„Ø§Ø«ÙŠ ÙˆØ¨Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·."); return; }
  if (!phoneOk) { alert("â— Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 0 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 11 Ø±Ù‚Ù…."); return; }
  if (!passOk) { alert("â— ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±."); return; }
  if (users.find(u=>u.phone === phone)) { alert("âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„."); return; }

  let code;
  do {
    code = Math.floor(Math.random() * (9999 - 1111 + 1)) + 1111;
  } while (users.find(u=>u.code === code));

  let user = { name, phone, password, code, role:"user" };
  users.push(user);
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('loggedUser', JSON.stringify(user));
  alert("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­. ÙƒÙˆØ¯Ùƒ: " + code);

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ÙÙˆØ±Ù… Formspree
  fetch("https://formspree.io/f/xovldbwb", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: name,
      phone: phone,
      password: password,
      code: code
    })
  });

  location.href = "myPurchases.html";
}

// ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
function login(){
  let phone = document.getElementById('loginPhone').value.trim();
  let password = document.getElementById('loginPass').value.trim();
  let user = users.find(u=>u.phone === phone && u.password === password);

  if(user){
    localStorage.setItem('loggedUser', JSON.stringify(user));
    alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.");
    if(user.role==="superadmin") location.href = "admin.html";
    else location.href = "myPurchases.html";
  }else{
    alert("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
  }
}

// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
function logout(){
  localStorage.removeItem('loggedUser');
  location.reload();
}

renderForms();
</script>

</body>
</html>
