<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🔑 تسجيل الدخول</title>
<style>
body { font-family:'Tahoma',sans-serif; margin:0; padding:0; text-align:center; background:#fff;}
header { background:#6c757d; color:#fff; padding:15px; font-size:22px;}
section { margin:20px auto; width:90%; max-width:400px;}
input { padding:6px; margin:6px auto; width:80%; max-width:250px;}
button { padding:6px 12px; margin-top:10px; font-size:14px; background:#6c757d; color:#fff; border:none; border-radius:4px; cursor:pointer;}
button:hover { background:#555;}
footer { background:#f1f1f1; text-align:center; padding:8px; font-size:13px; color:#777; border-top:1px solid #ddd;}
</style>
</head>
<body>

<header>🔑 تسجيل الدخول</header>

<section>
  <input type="text" id="phone" placeholder="رقم الموبايل"><br/>
  <input type="number" id="code" placeholder="الكود"><br/>
  <button onclick="loginUser()">✅ تسجيل الدخول</button>
</section>

<footer>💎 Powered by Almasa 💎</footer>

<script>
// بيانات سوبر أدمين
let superAdmin = { phone:"01552402913", code:790707071 };

// أكواد المدراء (يتم تحميلها من localStorage أو إعدادها لأول مرة)
let defaultAdmins = [
  {name:"admin1", phone:"01111111111", code:9999},
  {name:"admin2", phone:"01111111112", code:9998},
  {name:"admin3", phone:"01111111113", code:9997},
  {name:"admin4", phone:"01111111114", code:9996},
  {name:"admin5", phone:"01111111115", code:9995}
];
if(!localStorage.getItem('admins')){
  localStorage.setItem('admins', JSON.stringify(defaultAdmins));
}

function loginUser(){
  let phone=document.getElementById('phone').value.trim();
  let code=parseInt(document.getElementById('code').value.trim());
  if(!phone || isNaN(code)){ alert("⚠️ أدخل رقم الموبايل والكود"); return; }

  let admins=JSON.parse(localStorage.getItem('admins')||"[]");

  if(phone===superAdmin.phone && code===superAdmin.code){
    // تسجيل دخول كسوبر أدمين
    localStorage.setItem('loggedUser', JSON.stringify({name:"superadmin", code:superAdmin.code, phone:superAdmin.phone}));
    location.href="admin.html";
  }
  else if(admins.find(a=>a.phone===phone && a.code===code)){
    // تسجيل دخول كمدير عادي
    let admin = admins.find(a=>a.phone===phone && a.code===code);
    localStorage.setItem('loggedUser', JSON.stringify({name:admin.name, code:admin.code, phone:admin.phone}));
    location.href="admin.html";
  }
  else if(code>=2006 && code<=9998){
    // تسجيل دخول كعميل عادي
    let users=JSON.parse(localStorage.getItem('users')||"[]");
    let user=users.find(u=>u.phone===phone && u.code===code);
    if(user){
      localStorage.setItem('loggedUser', JSON.stringify({name:user.name, code:user.code, phone:user.phone}));
      location.href="myPurchases.html";
    } else {
      alert("⚠️ لا يوجد مستخدم مسجل بهذه البيانات");
    }
  }
  else{
    alert("⚠️ بيانات غير صحيحة");
  }
}

// التقاط تسجيل خروج في تبويبة أخرى
window.addEventListener('storage',function(e){
  if(e.key==='loggedUser' && e.newValue===null){
    alert("👋 تم تسجيل خروجك");
  }
});
</script>

</body>
</html>
